
var socket=null;var user="";var ubutton=null;var lockMsg=null;var userSuggestions=null;function onMessage(e){var f=JSON.parse(e.data);if(f.action==="loginresponse"){if(f.message==="success"){document.getElementById("loginerror").style.display="none";document.getElementById("begin").style.display="none";document.getElementById("middle").style.display="";document.getElementById("Userbox").focus();window.localStorage.setItem("token",f.token)}else{document.getElementById("loginerror").style.display=""}}else{if(f.action==="userinfo"){document.getElementById("usererror").style.display="none";document.getElementById("content").style.display="";displayUserInfo(f)}else{if(f.action==="locked"){ubutton.style.display="none";lockMsg.nodeValue="Locked";displayUserInfo(f)}else{if(f.action==="unlocked"){ubutton.style.display="none";lockMsg.nodeValue="Unlocked"}else{if(f.action==="nologin"){document.getElementById("loginerror").style.display="none";document.getElementById("begin").style.display="";document.getElementById("middle").style.display="none";var d=document.getElementById("content");if(d.firstChild){d.removeChild(d.firstChild)}}else{if(f.action==="nouser"){var c=document.getElementById("userinfoForm");var a=c.elements.User.value;document.getElementById("usererror").innerHTML=a+" not found";document.getElementById("usererror").style.display="";document.getElementById("content").style.display="none";var d=document.getElementById("content");if(d.firstChild){d.removeChild(d.firstChild)}}else{if(f.action==="suggestion"){userSuggestions.add(f.suggestion);var g=document.getElementById("userinfoForm").elements.User.value;$(".typeahead").typeahead("val","").typeahead("val",g)}else{if(f.action==="cachedlogin"&&f.message==="failed"){document.getElementById("begin").style.display="";window.localStorage.removeItem("token")}else{if(f.action==="keepalive"){var b={action:"keepalive"};sendToSocket(JSON.stringify(b))}}}}}}}}}}function displayUserInfo(c){var f=document.getElementById("content");if(f.firstChild){f.removeChild(f.firstChild)}var d=document.createElement("div");f.appendChild(d);var j=document.createElement("table");j.setAttribute("class","table");var i=document.createElement("tbody");var g={"Full Name":c.displayname,Email:c.mailnickname,"UP ID":c.employeeid,"Password Last Changed":c.pwdlastset,"Password Set to Expire":c.passwordsettoexpire,"Days Before Password Expires":c.daysleft,"Last Login":c.lastlogon,"Last Bad Password":c.badpasswordtime,"Account Expiration Date":c.accountexpires,"Other Email":c.othermailbox,"Bad Password Count":c.badpwdcount,Groups:c.memberof};for(var a in g){var h=document.createElement("tr");var b=document.createElement("th");b.appendChild(document.createTextNode(a));var e=document.createElement("td");e.innerHTML=g[a];h.appendChild(b);h.appendChild(e);i.appendChild(h)}if(c.lockouttime!=="N/A"&&c.lockouttime!=="0"){var h=document.createElement("tr");var b=document.createElement("th");b.appendChild(document.createTextNode("Locked Status"));var e=document.createElement("td");e.appendChild(ubutton);e.setAttribute("id","unlockcell");e.appendChild(lockMsg);e.appendChild(ubutton);h.appendChild(b);h.appendChild(e);i.appendChild(h)}j.appendChild(i);d.appendChild(j)}function sendToSocket(a){if(!socket||(socket&&socket.readyState===socket.CLOSED)){console.log("Reconnecting");socket=new WebSocket("ws"+(window.location.protocol==="https:"?"s":"")+"://"+window.location.host+window.location.pathname+"actions");socket.onmessage=onMessage;socket.onopen=function(){tokenLogin();socket.send(a)}}else{socket.send(a)}}function formUnlock(){if(user){var a={action:"unlock",user:user};sendToSocket(JSON.stringify(a))}}function formLogin(){var c=document.getElementById("loginForm");var d=c.elements.Username.value;var b=c.elements.Password.value;document.getElementById("loginForm").reset();var a={action:"login",username:d,password:b};sendToSocket(JSON.stringify(a));return false}function tokenLogin(){var b=window.localStorage.getItem("token");if(b!==null&&b.length!==38){var a={action:"cachedlogin",token:b};sendToSocket(JSON.stringify(a))}else{document.getElementById("begin").style.display=""}}function formGetUserInfo(){var b=document.getElementById("userinfoForm");user=b.elements.User.value;document.getElementById("loginForm").style.display="none";var a={action:"getuserinfo",user:user};sendToSocket(JSON.stringify(a));return false}function searchUsers(d){var c=document.getElementById("userinfoForm");if(d.keyCode===13){$(".typeahead").typeahead("close");formGetUserInfo(null)}user=c.elements.User.value;var b=Date.now();if(user.length>0){var a={action:"suggestion",user:user,timestamp:b};sendToSocket(JSON.stringify(a))}return false}function init(){ubutton=document.createElement("button");ubutton.innerHTML="Unlock";ubutton.setAttribute("id","unlockbutton");ubutton.setAttribute("class","btn btn-secondary bluebutton");ubutton.onclick=formUnlock;lockMsg=document.createTextNode("");userSuggestions=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,});$(".typeahead").typeahead({hint:true,highlight:true,minLength:1},{name:"userSuggestions",source:userSuggestions,limit:8});$(".typeahead").bind("typeahead:select",function(b,a){formGetUserInfo()});document.getElementById("Userbox").onkeyup=searchUsers;socket=new WebSocket("ws"+(window.location.protocol==="https:"?"s":"")+"://"+window.location.host+window.location.pathname+"actions");socket.onmessage=onMessage;socket.onopen=tokenLogin;socket.onclose=function(){setTimeout(function(){socket=new WebSocket("ws"+(window.location.protocol==="https:"?"s":"")+"://"+window.location.host+window.location.pathname+"actions")},5000)}}window.onload=init;