
window.onload=init;var socket=new WebSocket("wss://"+window.location.host+window.location.pathname+"actions");socket.onmessage=onMessage;var user="";var ubutton=document.createElement("button");ubutton.innerHTML="Unlock";var lockMsg=document.createTextNode("");ubutton.setAttribute("id","unlockbutton");ubutton.setAttribute("class","btn btn-secondary bluebutton");ubutton.onclick=function(){formUnlock()};function onMessage(d){console.log("recieved event");var e=JSON.parse(d.data);if(e.action==="loginresponse"){if(e.message==="success"){console.log("recieved login response: success");document.getElementById("loginerror").style.display="none";document.getElementById("begin").style.display="none";document.getElementById("middle").style.display="";document.getElementById("Userbox").focus()}else{console.log("recieved login response: error");document.getElementById("loginerror").style.display=""}}else{if(e.action==="userinfo"){console.log("recieved user info response");document.getElementById("usererror").style.display="none";document.getElementById("content").style.display="";displayUserInfo(e)}else{if(e.action==="locked"){console.log("account still locked");ubutton.style.display="none";lockMsg.nodeValue="Locked";displayUserInfo(e)}else{if(e.action==="unlocked"){console.log("account successfully unlocked");ubutton.style.display="none";lockMsg.nodeValue="Unlocked"}else{if(e.action==="nologin"){console.log("recieved login error response");document.getElementById("loginerror").style.display="none";document.getElementById("begin").style.display="";document.getElementById("middle").style.display="none";var c=document.getElementById("content");if(c.firstChild){c.removeChild(c.firstChild)}}else{if(e.action==="nouser"){console.log("user not found");var b=document.getElementById("userinfoForm");var a=b.elements.User.value;document.getElementById("usererror").innerHTML=a+" not found";document.getElementById("usererror").style.display="";document.getElementById("content").style.display="none";var c=document.getElementById("content");if(c.firstChild){c.removeChild(c.firstChild)}}}}}}}}function displayUserInfo(c){var g=document.getElementById("content");if(g.firstChild){g.removeChild(g.firstChild)}var e=document.createElement("div");g.appendChild(e);var k=document.createElement("table");k.setAttribute("class","table");var j=document.createElement("tbody");var b=["Full Name","Email","UP ID","Password Last Changed","Password Set to Expire","Days Before Password Expires","Last Login","Last Bad Password","Account Expiration Date","Last Login","Other Email"];var d=[c.displayname,c.mailnickname,c.employeeid,c.pwdlastset,c.passwordsettoexpire,c.daysleft,c.lastlogon,c.badpasswordtime,c.accountexpires,c.lastlogontimestamp,c.othermailbox];for(i=0;i<b.length;i++){var h=document.createElement("tr");var a=document.createElement("th");a.appendChild(document.createTextNode(b[i]));var f=document.createElement("td");f.appendChild(document.createTextNode(d[i]));h.appendChild(a);h.appendChild(f);j.appendChild(h)}if(c.lockouttime!=="N/A"&&c.lockouttime!=="0"){console.log("Lockout time: "+c.lockouttime);var h=document.createElement("tr");var a=document.createElement("th");a.appendChild(document.createTextNode("Locked Status"));var f=document.createElement("td");f.appendChild(ubutton);f.setAttribute("id","unlockcell");f.appendChild(lockMsg);f.appendChild(ubutton);h.appendChild(a);h.appendChild(f);j.appendChild(h)}k.appendChild(j);e.appendChild(k)}function formUnlock(){if(user){console.log("Unlocking "+user);var a={action:"unlock",user:user};socket.send(JSON.stringify(a))}else{console.log("User not found")}}function formLogin(){var c=document.getElementById("loginForm");var d=c.elements.Username.value;var b=c.elements.Password.value;document.getElementById("loginForm").reset();var a={action:"login",username:d,password:b};socket.send(JSON.stringify(a));return false}function formGetUserInfo(){var b=document.getElementById("userinfoForm");user=b.elements.User.value;document.getElementById("loginForm").style.display="none";var a={action:"getuserinfo",user:user};socket.send(JSON.stringify(a));return false}function init(){document.getElementById("middle").style.display="none";document.getElementById("loginerror").style.display="none";document.getElementById("usererror").style.display="none"};